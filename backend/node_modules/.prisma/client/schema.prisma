generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           String      @id @default(uuid())
  email        String      @unique
  passwordHash String      @map("password_hash")
  fullName     String      @map("full_name")
  role         String      @default("LINEFEEDER") // ADMIN, TEAM_LEADER, LINEFEEDER, MONITOR, DEPARTMENT
  departmentId String?     @map("department_id")
  department   Department? @relation(fields: [departmentId], references: [id])
  isActive     Boolean     @default(true) @map("is_active")
  createdAt    DateTime    @default(now()) @map("created_at")
  lastLogin    DateTime?   @map("last_login")

  statusHistory StatusHistory[]
  notifications Notification[]
  currentPoints RedPoint[]      @relation("CurrentUser")

  @@map("users")
}

model Department {
  id        String   @id @default(uuid())
  name      String   @unique
  location  String?
  createdAt DateTime @default(now()) @map("created_at")
  isActive  Boolean  @default(true) @map("is_active")

  users     User[]
  redPoints RedPoint[]

  @@map("departments")
}

model RedPoint {
  id            String     @id @default(uuid())
  pointNumber   Int        @unique @map("point_number")
  departmentId  String     @map("department_id")
  department    Department @relation(fields: [departmentId], references: [id])
  status        String     @default("LEDIG") // LEDIG, UPPTAGEN, SKRAP, KUNDORDER
  qrCode        String     @unique @map("qr_code")
  locationX     Float?     @map("location_x")
  locationY     Float?     @map("location_y")
  currentUserId String?    @map("current_user_id")
  currentUser   User?      @relation("CurrentUser", fields: [currentUserId], references: [id])
  lastUpdated   DateTime   @default(now()) @map("last_updated")
  isActive      Boolean    @default(true) @map("is_active")

  statusHistory StatusHistory[]
  notifications Notification[]

  @@map("red_points")
}

model StatusHistory {
  id         String   @id @default(uuid())
  pointId    String   @map("point_id")
  point      RedPoint @relation(fields: [pointId], references: [id])
  userId     String   @map("user_id")
  user       User     @relation(fields: [userId], references: [id])
  oldStatus  String   @map("old_status") // LEDIG, UPPTAGEN, SKRAP, KUNDORDER
  newStatus  String   @map("new_status") // LEDIG, UPPTAGEN, SKRAP, KUNDORDER
  actionType String   @map("action_type") // PICKUP, COMPLETE, SCAN, STATUS_CHANGE
  timestamp  DateTime @default(now())
  notes      String?

  @@map("status_history")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  user      User     @relation(fields: [userId], references: [id])
  pointId   String   @map("point_id")
  point     RedPoint @relation(fields: [pointId], references: [id])
  type      String // KUNDORDER, SKRAP, URGENT
  message   String
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")
  priority  Int      @default(3)

  @@map("notifications")
}
